<style>
.modal2 {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.modal2.active {
  display: flex;
}

.modal2-content2 {
  background: var(--bg2);;
  width: 1000px;
  height: 600px;
  max-width: 1000px;
  max-height: 600px;
  overflow: hidden;
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  padding: 20px;
  box-sizing: border-box;
}

/* Cabeçalho fixo */
.modal2-header2 {
  border-bottom: 1px solid #ddd;
  display: flex;
  align-items: center;
  flex-shrink: 0;
  padding: 5px 5px 20px;
  font-weight: bold;
  /* justify-content: space-between; */
}

/* Botão de fechar moderno */
.modal2-close2 {
  background-color: #1a75ff;
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  font-size: 1.2rem;
  font-weight: bold;
  cursor: pointer;
  line-height: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.3s ease;
  margin-left: auto;
}

.modal2-close2:hover {
  background-color: #385ce9;
}

/* Área que contém os campos */
.conteudo-x {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  overflow-y: auto;
  margin-bottom: 10px;
  justify-content: center;
  align-content: center;
}

/* Label acima do campo */
.conteudo-x label {
  margin-bottom: 4px;
  font-size: 0.9rem;
  font-weight: 700;
}

/* Campos de input, select, textarea */
.conteudo-x input,
.conteudo-x select {
  padding: 6px 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 0.95rem;
  width: 100% !important;
}

/* Div de campos adicionais */
#nova_tarefa {
  flex: 1 1 auto;
  overflow-y: auto;
  padding: 5px;
  max-height: 95%;
  box-sizing: border-box;

  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  align-content: flex-start;
}

/* Garante que todos os grupos de campos ocupem exatamente 200px */
#nova_tarefa .campo-bloco {
  width: 300px;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

/* Espaçamento entre label e campo */
#nova_tarefa .campo-bloco label {
  margin-bottom: 4px;
  font-size: 0.9rem;
  font-weight: 700;
}

/* Campos uniformes (inputs, selects, textareas) */
#nova_tarefa .campo-bloco input,
#nova_tarefa .campo-bloco select,
#nova_tarefa .campo-bloco textarea {
  width: 100%;
  box-sizing: border-box;
  padding: 6px 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 0.95rem;
}



/* estilização para campos extras */
.campo-extra label {
  color: rgb(112, 107, 107);
}

.campo-extra input,
.campo-extra textarea {
  background-color: #f5f5f5;
  color: #333;
}

.modal2-content2,
.modal2-header2 {
  cursor: grab;
}

  #selected_id, #n_tp_servico, #type_id {
    color: #3498db;
    border: 1px solid #3498db;
    border-radius: 4px;
    transition: 
      background-color 0.3s ease, 
      box-shadow 0.3s ease,   
      transform 0.1s ease;
  }

  #n_tp_servico:hover {
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }

  #type_id:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }

  #selected_id:hover {
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    animation: shake 0.5s ease-in-out;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25%      { transform: translateX(-3px); }
    50%      { transform: translateX(3px); }
    75%      { transform: translateX(-3px); }
  }

</style>

<script src="{{ url_for('static', filename='js/campos_telas.js') }}"></script>
<script src="{{ url_for('static', filename='js/modal_criar_tar_graf.js') }}"></script>

<div id="modal2" class="modal2">
  <div class="modal2-content2" title="Segure com o botão direito para arrastar">
    <center><div id="local-mensagens"></div></center> <br>
    <div class="modal2-header2" title="Segure com o botão direito para arrastar">
        
        <div class="acima">
          <label for="n_tp_servico"><strong>Tipo de serviço:</strong></label><br>
          <select name="n_tp_servico" id="n_tp_servico" onchange="selecionaCamposServico('0');" style="color:#3498db;" >
            <option value=""></option>
            <option value="1">Mv Arquivo</option>
            <option value="2">Up Arq GCP</option>
            <option value="3">Download Arq GCP</option>
            <option value="4">Proc. GCP</option>
            <option value="5">Python</option>
            <option value="6">EGP SAS</option>
            <option value="7">VBA no Excel</option>
            <option value="8">Up Arq Servidor SAS</option>
            <option value="9">Download Arq Servidor SAS</option>
            <option value="10">Script VBS</option>
            <option value="11">Gatilho Py</option>
            <option value="12">Importa Arq GCP</option>
            <option value="13">Movimento MFT</option>
          </select>
        </div>
        <div>
          <label for="selected_id"><strong>ID Tarefa:</strong></label><br>
          <input type="text" id="selected_id" onclick="link_para_tela_id();" readonly style="text-align:center; max-width: 100px;color:#3498db;" title="Link para a pagina de cadastros de tarefas">
        </div>
        <div>
          <label for="type_id"><strong>Tipo:</strong></label><br>
          <input type="text" id="type_id" readonly style="text-align:center; max-width: 100px;color:#3498db;">
        </div>
        
      <input type="button" class="modal2-close2" id="btnCloseModal2" value="&times;"> 
      
    </div>
    <br>
    <div id="nova_tarefa"></div>

    <div style="text-align: center; margin-top: 20px;">
      

      <button id="btnReiniciar" class="bt1" onclick="resetar_tarefa_modal_grafico1();" title="Reiniciar esta tarefa">&nbsp;Reiniciar Tarefa&nbsp;</button>
      <button id="btnReiniciarCadeia" class="bt1" onclick="resetar_cadeia_modal_grafico1();" title="Reiniciar todas as tarefas desta cadeia">&nbsp;Reiniciar Toda Cadeia&nbsp;</button>
      <button id="btnIniciar" class="bt1" onclick="forca_inicio();" title="Forçar o inicio da tarefa, indiferente das dependências">&nbsp;Forçar Inicio Tarefa&nbsp;</button>

      <button id="btnOkModal4" class="bt1" onclick="funcao_consultar_historico_no_modal();" style="background-color: #9faabb;" title="Consultar histórico de execuções">&nbsp;Histórico&nbsp;</button>
      
      <button id="btnOkModal2" class="bt1" onclick="salvar_tarefa();" style="background-color: #9b59b6;" title="Salvar ou criar tarefa">Salvar</button>
      <button id="btnOkModal3" class="bt1" onclick="funcao_remover_tarefa_grafico();" style="background-color: #e74c3c;" title="Destruir tarefa">Remover</button> 
      
    </div>

  </div>
</div>


<script>

(function() {
  const modal = document.querySelector('.modal2-content2');
  const header = modal.querySelector('.modal2-header2');

  [modal, header].forEach(el =>
    el.addEventListener('contextmenu', e => e.preventDefault())
  );

  const initDrag = e => {
    if (e.button !== 2) return;   // só botão direito
    e.preventDefault();

    // troca cursor
    [modal, header].forEach(el => el.style.cursor = 'grabbing');

    const rect = modal.getBoundingClientRect();
    const offsetX = e.clientX - rect.left;
    const offsetY = e.clientY - rect.top;

    modal.style.position = 'absolute';
    modal.style.margin = '0';
    modal.style.top = `${rect.top}px`;
    modal.style.left = `${rect.left}px`;

    const onMouseMove = e => {
      modal.style.top = `${e.clientY - offsetY}px`;
      modal.style.left = `${e.clientX - offsetX}px`;
    };

    const onMouseUp = () => {
      document.removeEventListener('mousemove', onMouseMove);
      document.removeEventListener('mouseup', onMouseUp);
      [modal, header].forEach(el => el.style.cursor = 'grab');
    };

    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('mouseup', onMouseUp);
  };

  [modal, header].forEach(el =>
    el.addEventListener('mousedown', initDrag)
  );
})();



</script>


{% include 'modal_historico.html' %}